<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="js/images/wrf-icon-tiny.ico"/>
    <title>Legionella - WRF</title>


    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css?family=Roboto:500" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link href='https://watergis.github.io/mapbox-gl-legend/mapbox-gl-legend.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/map.css" />
	<link rel="stylesheet" href="css/custombuttons.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/databar.css" />
	<link rel="stylesheet" href="css/titlebar.css" />
	<link rel="stylesheet" href="css/attributetable.css" />	
    <link rel="stylesheet" href="css/tabs.css" />
    <link rel="stylesheet" href="css/popup.css" />

  </head>
  <body>
    <!-- Sidebar -->
    <!-- Map -->

    <div id="titlebar">
      <div id = "title" ><img src="js/images/wrf-icon.png" style="width: 53px;height: 65px;padding: 0px 15px 10px 0px;">Legionella Visualizer</div>
      <div id = "desc" class = "text">An app for predicting vulnerability of water distribution systems to Legionella exposure</div>
	  <div id = "titlelink" class = "text"><a href="https://www.waterrf.org/research/projects/sampling-and-monitoring-strategies-opportunistic-pathogens-drinking-water" target="_blank">WRF Project #4911</a></div>
    </div>

    <div id="sidebar">
		
		<div class="tabs">
		<div class="tab" data-target="Dist-Tab">Distribution Data</div>
		  <div class="tab active" data-target="WQ-Tab">Water Quality Data</div>
		</div>
		<div id="panels">
		  <div class="WQ-Tab panel active">
				<div class = "uploadtext">
					Upload a csv containing water quality sample site data. Analyte data must have column names matching the table below. Coordinates must be stored in two columns named "Latitude" and "Longitude". Samples are summarized by location upon upload.&lrm;
					<div>
					<a href="js/documents/ExampleWQData.csv">Download an example CSV here</a>
					</div>
					<input type="file" id="csvUpload" hidden/>
					<label class = "custombutton csvbutton" for="csvUpload">Upload CSV File</label>
					<div id="csvUpload-file-chosen" >No file chosen</div>

				</div>

				<div class="legendtitle">Water Quality Analytes</div>
				<div class="table-wrap tableFixHead">
				<table id = "analytecontrol">
					<thead>
						<tr>
							<th style="width:100px">Analyte</th>
							<th >Unit</th>
							<th>Added to Model</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td class="text">Alkalinity</td>
							<td class="text">mg CaCO3/L</td>
							<td>
								<input type="checkbox" id="alkalinity-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Conductivity</td>
							<td class="text">umhos/cm</td>
							<td>
								<input type="checkbox" id="conductivity-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Copper</td>
							<td class="text">ug/L</td>
							<td>
								<input type="checkbox" id="copper-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Free_Chlorine</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="free_chlorine-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Hardness</td>
							<td class="text">mg CaCO3/L</td>
							<td>
								<input type="checkbox" id="hardness-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>					
						<tr>
							<td class="text">Iron</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="iron-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Lead</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="lead-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Manganese</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="manganese-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Nitrate</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="nitrate-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Nitrite</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="nitrite-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Orthophosphate</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="orthophosphate-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">ORP</td>
							<td class="text">mV</td>
							<td>
								<input type="checkbox" id="orp-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">pH</td>
							<td class="text"></td>
							<td>
								<input type="checkbox" id="pH-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Temperature</td>
							<td class="text">deg Celsius</td>
							<td>
								<input type="checkbox" id="temp-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Total_Chlorine</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="total_chlorine-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">E.Coli</td>
							<td class="text">Boolean</td>
							<td>
								<input type="checkbox" id="e.coli-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Total_Coliform</td>
							<td class="text">Boolean</td>
							<td>
								<input type="checkbox" id="total_coliform-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Total_Dissolved_Solids</td>
							<td class="text">mg/L</td>
							<td>
								<input type="checkbox" id="total_dissolved_solids-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Total_Haloacetic_Acids</td>
							<td class="text">ug/L</td>
							<td>
								<input type="checkbox" id="total_haloacetic_acids-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Total_Trihalomethanes</td>
							<td class="text">ug/L</td>
							<td>
								<input type="checkbox" id="total_trihalomethanes-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
						<tr>
							<td class="text">Turbidity</td>
							<td class="text">NTU</td>
							<td>
								<input type="checkbox" id="turbidity-check" value="false" onchange="recalculateGeoJSON()">
							</td>
						</tr>
					</tbody>
					
				</table>
				</div>
				<div class = "text" style="font-size:10px; color:black; margin-top:5px;">*Boolean data must consist of 0 (absent) and 1 (present)</div>
				<div class = "text" style="font-size:10px; color:black;">**Matching fields in csv will have blue border on checkbox</div>

				
					  </div>
		  <div class="Dist-Tab panel">
				<div class = "disttext">
					Upload geojsons for key distribution assets. Each geojson must have a WGS 1984 projection. The Main geojson must have a LineString geometry and all others must have Point geometries.&lrm;
				</div>
				<a id="downloadMainJSON" class = "disttext" href="js/documents/ExampleMains.json">Download an example Mains geojson here</a><br>
				<a id="downloadHydrantJSON" class = "disttext" href="js/documents/ExampleHydrants.json">Download an example Hydrants geojson here</a>
				
				<div class="legendtitle">Key WQ Distribution Layers</div>
				
				<div class="table-wrap">
				<table id = "distcontrol">
					<tr>
						<th style="width:100px">Asset</th>
						<th >Added to Map</th>
						<th>Added to Model</th>
					</tr>
					<tr>
						<td class="text">Main</td>
						<td>
							<input type="file" id="mainUpload" hidden/>
							<label class = "custombutton geobutton" for="mainUpload">Upload</label>
							<div class="geo-file-chosen" id="Main-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="maincheck" value="true">
						</td>
					</tr>
					<tr>
						<td class="text">Hydrant</td>
						<td>
							<input type="file" id="hydrantUpload" hidden/>
							<label class = "custombutton geobutton" for="hydrantUpload">Upload</label>
							<div class="geo-file-chosen" id="Hydrant-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="hydrantcheck" value="true">
						</td>
					</tr>	
					<tr>
						<td class="text">Storage Tank</td>
						<td>
							<input type="file" id="tankUpload" hidden/>
							<label class = "custombutton geobutton" for="tankUpload">Upload</label>
							<div class="geo-file-chosen" id="StorageTank-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="tankUploadcheck" value="true">
						</td>
					</tr>
					<tr>
						<td class="text">Booster Station w/ Disinfectants</td>
						<td>
							<input type="file" id="disboosterUpload" hidden/>
							<label class = "custombutton geobutton" for="disboosterUpload">Upload</label>
							<div class="geo-file-chosen" id="DisBooster-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="disboosterUploadcheck" value="true">
						</td>
					</tr>
					<tr>
						<td class="text">Booster Station w/o Disinfectants</td>
						<td>
							<input type="file" id="boosterUpload" hidden/>
							<label class = "custombutton geobutton" for="boosterUpload">Upload</label>
							<div class="geo-file-chosen" id="Booster-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="boosterUploadcheck" value="true">
						</td>
					</tr>
					<tr>
						<td class="text">Clear Well</td>
						<td>
							<input type="file" id="wellUpload" hidden/>
							<label class = "custombutton geobutton" for="wellUpload">Upload</label>
							<div class="geo-file-chosen" id="ClearWell-upload-file-chosen"></div>					
						</td>
						<td>
							<input type="checkbox" id="wellUploadcheck" value="true">
						</td>
					</tr>
				</table>
				</div>
				
				
		  </div>
		</div>
  
    </div>


    <div id="databar">
		<div id="dataTitle">Vulnerability Analysis</div>
		
		<div>
			<div class="legendtitle" style="float: left;padding-left: 35px;">Vulnerability Score Equation</div>
			<div class="popup" onclick="describeParamsinPopUp();">
				<img src="js/images/help.png" style="margin-bottom:5px" width="20" height="20" alt="img" />
				<span class="popuptext" id="myPopup" style="font-size: 13px;">A Simple Popup!</span>
			</div>
		</div>
		
		<div id = "equationbox">
			<div id="equation"></div>
		</div>
		
		<table class="legend">
		<caption class="legendtitle">Score Legend</caption>
		  <tr>
			<td class="circle" style="background: blue;"></td>
			<td id="minLegend" class="text">Low scores</td>
		  </tr>
		  <tr>
			<td class="circle" style="background: yellow;"></td>
			<td id="midLegend" class="text">Medium scores</td>
		  </tr>
		  <tr>
			<td class="circle" style="background: red;"></td>
			<td id="maxLegend" class="text">High scores</td>
		  </tr>
		</table>	
		
		<table class="stats">
		<caption class="legendtitle">Score Statistics of All Samples</caption>
		  <tr>
			<td class="text">Valid Scores</td>
			<td id="count-stat" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Mean</td>
			<td id="mean-stat" class="text">N/A</td>
		  </tr>
		  <tr>
		  <tr>
			<td class="text">Median</td>
			<td id="median-stat" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Standard Deviation</td>
			<td id="stdev-stat" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Skewness</td>
			<td id="skew-stat" class="text">N/A</td>
		  </tr>
		</table>	
		
		<table class="stats">
		<caption class="legendtitle">Score Statistics of Selected Sample Site</caption>
		  <tr>
			<td class="text">Site Coordinates</td>
			<td id="loc-stat-select" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Valid Scores at Location</td>
			<td id="count-stat-select" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Mean</td>
			<td id="mean-stat-select" class="text">N/A</td>
		  </tr>
		  <tr>
		  <tr>
			<td class="text">Median</td>
			<td id="median-stat-select" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Standard Deviation</td>
			<td id="stdev-stat-select" class="text">N/A</td>
		  </tr>
		  <tr>
			<td class="text">Skewness</td>
			<td id="skew-stat-select" class="text">N/A</td>
		  </tr>
		</table>	
	</div>

    <div id="attributetable">
		<div style="position:relative;">
			<button id="exportButton" class="export zoombutton" onclick="exportTable()">Export Summary</button>
			<button id="exportRawButton" class="export zoombutton" style="margin-left: 5px" onclick="exportRawTable()">Export Raw</button>
			<div id="attributetitle">Summary Attribute Table</div>
			<button id="attributecontrol" class="zoombutton" onclick="closeAttributeTable()">Close</button>
		</div>
		<div class="tableFixHead noWrapTable" style="clear:both;">
			<table id="attributes">
				<thead id="attributesHeader">
				</thead>
				<tbody id="attributesBody">
				</tbody>
			</table>
		</div>
	</div>


    <div id="map" class="map"></div>





    <!-- Javascript Imports Here -->
    <script> mapboxgl.accessToken = 'pk.eyJ1IjoibGVvc2hhdzU3IiwiYSI6ImNqdDNndm1pZTJhM3Q0NG9zYW41ZzBoNDEifQ.tKNCXe9vMN94CtgABlIjPg' </script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore.js" integrity="sha256-O4179En8zabOlPYBNvGp8cF0uh0vnSZpW4Q6Ul1h+8c=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.js"></script>	
	<script src="https://watergis.github.io/mapbox-gl-legend/mapbox-gl-legend.js"></script>
	
    <script src="js/calculateRisk.js"></script>
	<script src="js/uploadCSV.js"></script>
	<script src="js/uploadGeo.js"></script>	
	<script src="js/tabs.js"></script>
    <script src="js/map.js"></script>
	<script src="js/mapPopUps.js"></script>
	<script src="js/exportData.js"></script>
	




  </body>
</html>
