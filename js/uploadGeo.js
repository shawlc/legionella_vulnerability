
var keyDistAssets = {
	"Main":{
		type:"line",
		symbology:{
			'type': 'line',
			'layout': {
				'line-join': 'round',
				'line-cap': 'round'
				},
			'paint': {
				'line-color': 'blue',
				'line-width': 2
				}
		}
	},
	"Hydrant":{
		data:{},
		type:"point",
		symbology:{
			'type': 'circle',
				'paint': {
				'circle-radius': 2,
				'circle-color': "#A42626",
				"circle-stroke-color": "black",
				"circle-stroke-width": 1
				}
			}
	},
	"StorageTank":{
		data:{},
		type:"point",
		symbology:{
			'type': 'circle',
				'paint': {
				'circle-radius': 8,
				'circle-color': "grey",
				"circle-stroke-color": "black",
				"circle-stroke-width": 1
				}
			}
	},
	"DisBooster":{
		data:{},
		type:"point",
		symbology:{
			'type': 'circle',
				'paint': {
				'circle-radius': 8,
				'circle-color': "blue",
				"circle-stroke-color": "black",
				"circle-stroke-width": 1
				}
			}
	},
	"Booster":{
		data:{},
		type:"point",
		symbology:{
			'type': 'circle',
				'paint': {
				'circle-radius': 8,
				'circle-color': "#0EF7F1",
				"circle-stroke-color": "black",
				"circle-stroke-width": 1
				}
			}
	},
	"ClearWell":{
		data:{},
		type:"point",
		symbology:{
			'type': 'circle',
				'paint': {
				'circle-radius': 8,
				'circle-color': "black",
				"circle-stroke-color": "white",
				"circle-stroke-width": 1
				}
			}
	}
}

function processGeoData(upload_element, fcname) {
  //Validate geoJSON
  var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.json)$/;
  if (regex.test(upload_element.value.toLowerCase())) {
	  console.log("Uploaded geojson with size: "+String(upload_element.size))
	  if (typeof (FileReader) != "undefined") {
		  if(upload_element.size < 200*1024*1024){
					var myReader = new FileReader();
					myReader.onload = function(e) {
					var dist_geoJSON = JSON.parse(myReader.result);
					/*
					let geomset = new Set();
					for (var i = 0; i < dist_geoJSON.features.length; i++) {
						geomset.add(dist_geoJSON.features[i].geometry.type)
					}
					dist_geoJSON["geomtypes"] = Array.from(geomset)
					*/
					keyDistAssets[fcname]["data"] = dist_geoJSON
					visualizeDistData(fcname);
				  }
					myReader.readAsText(upload_element.files[0]);

		  }else{
			  alert("geoJSON file must be less than 200 MB")
		  }
	  }else{
		  alert("This browser does not support HTML5.");
	  }
  }else{
	  alert("Please upload a valid geoJSON file.");
  }
}

document.getElementById('mainUpload').onchange = function(){processGeoData(document.getElementById('mainUpload'), "Main");};
document.getElementById('hydrantUpload').onchange = function(){processGeoData(document.getElementById('hydrantUpload'), "Hydrant");};
document.getElementById('tankUpload').onchange = function(){processGeoData(document.getElementById('tankUpload'), "StorageTank");};
document.getElementById('disboosterUpload').onchange = function(){processGeoData(document.getElementById('disboosterUpload'), "DisBooster");};
document.getElementById('boosterUpload').onchange = function(){processGeoData(document.getElementById('boosterUpload'), "Booster");};
document.getElementById('wellUpload').onchange = function(){processGeoData(document.getElementById('wellUpload'), "ClearWell");};
